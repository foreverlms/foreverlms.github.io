	<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Installing g2o under Ubuntu 14.04</title>
	<meta name="description" content="g2o_viewer in Ubuntu 14.04">
	<meta name="keywords" content="tools, 寒鸥惊起一双双" />
	<link rel="canonical" href="http://localhost:4000/tips/2019/04/30/g2o-in-ubuntu14-04.html">
	<link rel="alternate" type="application/rss+xml" title="寒鸥惊起一双双" href="http://localhost:4000/feed.xml" />
   	<link rel="stylesheet" type="text/css" href="/css/index.css">
</head>

<body>
<div class="body-wrapper">
<div class="nav-header">
<a href="/">寒鸥惊起一双双</a> | <a href="https://github.com/foreverlms" target="_blank">Github</a> |<a href="/about">关于 </a></div>
<div class="main-body">
<header>
<h2>Installing g2o under Ubuntu 14.04</h2>
<p><i>Apr 30, 2019</i></p>
</header>
<article>
<p>g2o_viewer in Ubuntu 14.04
<!--more--></p>

<p>If you compile source code of <code class="highlighter-rouge">g2o</code> and install it under Ubuntu 14.04, you will find that the component of <code class="highlighter-rouge">g2o_viewer</code> won’t be installed. The reason is that <code class="highlighter-rouge">g2o</code> now depends on qt5, but there is only qt4 under Ubuntu 14.04. How can we solve this? I googled a lot and those methods of such as checking out to <a href="https://zhuanlan.zhihu.com/p/41200084">commit <code class="highlighter-rouge">8ba8a03f7863e1011e3270bb73c8ed9383ccc2a2</code></a> in which qt4 is g2o’s dependency. But I encountered many compiling errors when <code class="highlighter-rouge">make</code> and it was terminated. It really bothers me.</p>

<p>OK,I want to try another way.If the latest g2o needs qt5, should I install qt5 to the PC? Actually If you update your os to 16.04, there will be no problems. But I use ROS Indigo which should only be installed under 14.04. Unfortunately, it depends on qt4. So I can’t just uninstall qt4 and install qt5. I should have them both. Below are the procedures of installing qt5 and having the <code class="highlighter-rouge">g2o_viewer</code> component.</p>

<p>You can see this blog in this detailed <a href="https://github.com/RainerKuemmerle/g2o/issues/151#issuecomment-487873085">github issue</a>.</p>

<h2 id="install-qt5">Install QT5</h2>

<p>Just go to the official downloading link of the latest open-source <a href="https://www.qt.io/download#section-2">QT</a>.After downloading, just run the <code class="highlighter-rouge">qt*.run</code> to install QT(don’t forget to <code class="highlighter-rouge">chomod +777</code>). I suggest to install only the Tools and source components.</p>

<p>After installation, you will have both qt4 and qt5. But the <code class="highlighter-rouge">qmake</code> is still version 4. You should do some changes as the code below:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mv</span> /usr/lib/x86_64-linux-gnu/qt-default/qtchooser/default.conf /usr/lib/x86_64-linux-gnu/qt-default/qtchooser/default.conf_backup
<span class="nb">sudo </span>vim /usr/lib/x86_64-linux-gnu/qt-default/qtchooser/default.conf
</code></pre></div></div>
<p>Add the two lines to <code class="highlighter-rouge">default.conf</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>QT5_INSTALL_PATH_YOU_CHOOSE/VERSION_NUMBER_DIR/gcc_64/bin
QT5_INSTALL_PATH_YOU_CHOOSE/VERSION_NUMBER_DIR/gcc_64/lib
</code></pre></div></div>
<p>Then:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vim /etc/ld.so.conf.d/qt5_lib.conf
</code></pre></div></div>
<p>Add one line to this <code class="highlighter-rouge">qt5_lib.conf</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>QT5_INSTALL_PATH_YOU_CHOOSE/VERSION_NUMBER_DIR/gcc_64/lib
</code></pre></div></div>

<p>Then run <code class="highlighter-rouge">sudo ldconfig</code> to update the lib searching path. Now qt5 is available and if you type <code class="highlighter-rouge">qmake -v</code> you will get something like below:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>QMake version 3.1
Using Qt version 5.9.8 in /home/bob/software/qt5/5.9.8/gcc_64/lib
</code></pre></div></div>
<p>Test it : run <code class="highlighter-rouge">qtcreator</code>. If <code class="highlighter-rouge">qtcreator</code> can’t be launched and you have some errors like below:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./qtcreator: symbol lookup error: /home/bob/software/qt5/Tools/QtCreator/lib/Qt/plugins/platforms/../../lib/libQt5XcbQpa.so.5: undefined symbol: FT_Get_Font_Format
</code></pre></div></div>
<p>This is a fatal error. If you can’t solve this,then all the programs depend on qt5 won’t be launched, including <code class="highlighter-rouge">g2o_viewer</code>.</p>

<p>I spend a lot of time to solve this, I get nothing worked. Then I have to solve it by myself.</p>

<p>This error indicates that something is wrong with <code class="highlighter-rouge">libQt5XcbQpa.so.5</code> in <code class="highlighter-rouge">QT5_INSTALL_PATH_YOU_CHOOSE/VERSION_NUMBER_DIR/gcc_64/lib/</code>. We can <code class="highlighter-rouge">cd</code> to this directory and run:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ldd <span class="nt">-r</span> libQt5XcbQpa.so.5 | <span class="nb">grep </span>freetype
</code></pre></div></div>
<p>and you will have :</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>libfreetype.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libfreetype.so.6 (0x00007f77dfdf1000)
</code></pre></div></div>
<p>I googled and knew it should be something wrong with the version of lib <code class="highlighter-rouge">libfreetype.so.6</code>. In Ubuntu 14.04, the version of <code class="highlighter-rouge">freetype</code> is too old. To fix this, you should go to <code class="highlighter-rouge">freetype</code> <a href="https://www.freetype.org/download.html">downloading page</a> and unzip the file, install freetype to your PC as the documemtaion said. After this, you will have</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>libfreetype.so
libfreetype.so.6
libfreetype.so.6.17.0
</code></pre></div></div>
<p>in your <code class="highlighter-rouge">/usr/local/lib</code>.Do as follows:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mv</span> /usr/lib/x86_64-linux-gnu/libfreetype.so<span class="k">*</span> TO_SOME_WHERE_F0R_BACK_UP
<span class="nb">sudo cp</span> /usr/local/lib/libfreetype.so<span class="k">*</span> /usr/lib/x86_64-linux-gnu
</code></pre></div></div>
<p>Now this error should be fixed. We have had the QT5 done. It’s time to get <code class="highlighter-rouge">g2o</code> installed.</p>

<h2 id="install-g2o">Install g2o</h2>

<h3 id="install-libgql">Install libgql</h3>

<p><code class="highlighter-rouge">g2o_viewer</code> needs <code class="highlighter-rouge">libQGLViewer</code>. If you have installed <code class="highlighter-rouge">libqglviewer-dev</code> before, uninstall it via <code class="highlighter-rouge">sudo apt-get remove libqglviewer*</code>.</p>

<p>Go to <a href="http://libqglviewer.com/installUnix.html">libqglviewer</a>, download latest version and install it as the documentation said.</p>

<p><strong>If your compilaton couldn’t find libQGLViewer</strong>, you shoud do the following:
Go to the source dirtectory of <code class="highlighter-rouge">g2o</code>, modify the <code class="highlighter-rouge">FindQGLViewer.cmake</code>  in <code class="highlighter-rouge">cmake_modules</code> like below:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
find_library(QGLVIEWER_LIBRARY_RELEASE
##NAMES qglviewer QGLViewer qglviewer-qt5 QGLViewer-qt5
  NAMES qglviewer-qt5 QGLViewer-qt5
...
</code></pre></div></div>

<h3 id="modify-the-cmakeliststxt-of-g2o">Modify the CMakeLists.txt of <code class="highlighter-rouge">g2o</code></h3>

<p>If you just compile g2o, it won’t find the QT5 libs. So insert a variable to the <code class="highlighter-rouge">CMakeLists.txt</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># set the Qt5Config.cmake path
set(Qt5_DIR QT5_INSTALL_PATH_YOU_CHOOSE/VERSION_NUMBER_DIR/gcc_64/lib/cmake/Qt5)
</code></pre></div></div>

<h3 id="install-g2o-1">Install g2o</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>build
<span class="nb">cd </span>build
cmake ..
make <span class="nt">-j8</span>
make <span class="nb">install</span>
</code></pre></div></div>
<p>Now g2o is installed. And you can run g2o_viewer.</p>

<h3 id="install-libqglviewer">Install libqglviewer</h3>

<p>Remember that the <code class="highlighter-rouge">libqglviewer-dev</code> has been removed? We need to reinstall it in order for other programs depending on it.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>libqglviewer-dev
</code></pre></div></div>

<h2 id="unistallation">Unistallation</h2>

<p>If you don’t need these anymore.</p>
<h3 id="uninstall-qt5">Uninstall QT5</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./QT5_INSTALL_PATH_YOU_CHOOSE/MaintenanceTool
</code></pre></div></div>

<h3 id="uninstall-libqglviewer">Uninstall libQGLViewer</h3>

<p>Go to the build directory adn do:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo make uninstall
</code></pre></div></div>
<p>Libs of <code class="highlighter-rouge">libQGLViewer</code> are in <code class="highlighter-rouge">/usr/local/lib</code>.Header files are in <code class="highlighter-rouge">/usr/local/include/QGLViewer</code>.</p>
<h3 id="uninstall-g2o">Uninstall g2o</h3>
<p>If you want uninstall <code class="highlighter-rouge">g2o</code>, just :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo rm -rf /usr/local/incude/g2o
sudo rm -rf /usr/local/lib/libg2o*
</code></pre></div></div>
<h3 id="uninstall-freetype">Uninstall freetype</h3>

<p>If yo don’t need freetype anymore and want to uninstall the <code class="highlighter-rouge">freetype</code> you installed, make sure you move the original <code class="highlighter-rouge">libfreetype.so*</code> back.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm</span> <span class="nt">-f</span> /usr/local/lib/libfreetype.la
<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/lib/libfreetype.la /usr/local/lib/libfreetype.so.6.17.0 /usr/local/lib/libfreetype.so.6 /usr/local/lib/libfreetype.so /usr/local/lib/libfreetype.a
<span class="nb">rm</span> <span class="nt">-rf</span> /usr/local/include/freetype2
<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/bin/freetype-config
<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/share/aclocal/freetype2.m4
<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/lib/pkgconfig/freetype2.pc
<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/share/man/man1/freetype-config.1

</code></pre></div></div>

</article>
<div id="info-bottom">
<hr>    
<p>Tags: <block class="tag"><a href="/archive/#tools">tools</a></block></p>
<p><b>Comment</b> by <a href="https://github.com/foreverlms/foreverlms.github.io/issues"> Github Issues </a></p>
<p><b>Chat</b> in <a href="https://gitter.im/foreverlms/community">foreverlms</a> </p>
</div>
</div>
<div class="info-bottom"><div class="info-bottom-text">
License <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a> | Subscribe <a href="/feed.xml">RSS</a> | Email <a href="mailto:codechaser@163.com">codechaser@163.com</a> | 博客模板 <a href="https://fzheng.me/" target="_blank">无求备斋笔记</a>
</div></div> 
</div>
</body>
<script src="https://use.typekit.net/hvv6ahj.js"></script>
<script>try{Typekit.load({ async: true });}catch(e){}</script>
</html>